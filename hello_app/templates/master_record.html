{% extends "layout.html" %}
{% block content %}

<head>
	<title>Data Results</title>
	<script>
		$(document).ready(function () {
			$("#edit").click(function () {
				// Toggle edit mode for master record cells
				$(".editable").attr('contenteditable', function (_, value) {
					return value == 'false';
				});
			});

			$("#save").click(function () {
				// Collect updated data
				let updatedData = {
					ID: $("#master_table .editable.ID").text(),
					AN: $("#master_table .editable.AN").text(),
					Model: $("#master_table .editable.Model").text(),
					// Add more fields as necessary
				};

				// Send AJAX request to update master record
				$.ajax({
					url: "/master_record/" + updatedData.ID,
					type: "PUT",
					data: JSON.stringify(updatedData),
					contentType: "application/json",
					success: function (response) {
						alert(response.message);
					}
				});
			});
		});
	</script>
</head>

<body>
	<h1>Data Results</h1>
	<p>Master ID: {{ master_id }}</p>
	<!-- Show Master record -->
	{% if master_results %}
	<button id="edit">Edit</button>
	<button id="save">Save</button>
	<table id="master_table">
		<thead>
			<tr>
				<th>EDIT</th>
				<th>AN</th>
				<th>Model</th>
				<th>SN</th>
				<th>NOM</th>
				<th>LOC</th>
				<th>CAL DATE</th>
				<th>DUE</th>
				<th>CYCLE</th>
				<th>MANUFACTURE</th>
				<th>PROC</th>
				<th>SPECIAL CAL</th>
				<th>NOTE</th>
				<th>COST</th>
				<th>STANDARD</th>
				<th>Facility</th>
			</tr>

		</thead>
		<tbody>
			{% for result in master_results %}
			<tr>
				<td>{{ result['ID'] }}</td>
				<td>{{ result['AN'] }}</td>
				<td>{{ result['Model'] }}</td>
				<td>{{ result['SN'] }}</td>
				<td>{{ result['NOM'] }}</td>
				<td>{{ result['LOC'] }}</td>
				<td>{{ result['CAL DATE'] }}</td>
				<td>{{ result['DUE'] }}</td>
				<td>{{ result['CYCLE'] }}</td>
				<td>{{ result['MANUFACTURE'] }}</td>
				<td>{{ result['PROC'] }}</td>
				<td>{{ result['SPECIAL CAL'] }}</td>
				<td>{{ result['NOTE'] }}</td>
				<td>{{ result['COST'] }}</td>
				<td>{{ result['STANDARD'] }}</td>
				<td>{{ result['Facility'] }}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% endif %}
	<br />
	<!-- Show Test record -->
	{% if test_results %}
	<table id="test_table">
		<thead>
			<tr>
				<th>ID</th>
				<th>UNIT</th>
				<th>NOM</th>
				<th>ACTUAL</th>
				<th>TOL</th>
				<th>LOWTOL</th>
				<th>MAXTOL</th>
				<th>ERROR</th>
				<th>PASS</th>
			</tr>
		</thead>
		<tbody>
			{% for row in test_results %}
			<tr>
				<td>{{ row['ID'] }}</td>
				<td>{{ row['UNIT'] }}</td>
				<td>{{ row['NOM'] }}</td>
				<td>{{ row['ACTUAL'] }}</td>
				<td>{{ row['TOL'] }}</td>
				<td>{{ row['LOWTOL'] }}</td>
				<td>{{ row['MAXTOL'] }}</td>
				<td>{{ row['ERROR'] }}</td>
				<td>{{ row['PASS'] }}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	{% endif %}
	<br />
	<!-- Add new test form  -->
	<form action='/master_record/{{ master_id }}' method="post">
		<input type="hidden" name="master_id" value="{{ master_id }}">
		<label for="unit">Unit:</label>
		<input type="text" name="unit" id="unit" required>
		<label for="nom">Nominal:</label>
		<input type="number" name="nom" id="nom" step="0.000000000001" required>
		<label for="actual">Actual:</label>
		<input type="number" name="actual" id="actual" step="0.000000000001" required>
		<label for="tol">Tolerance:</label>
		<input type="number" name="tol" id="tol" step="0.000000000001" required>
		<button type="submit">Add Test Result</button>
	</form>
</body>
{% endblock %}